generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  // PERBAIKAN: Langsung tulis alamat database di sini (Bypass .env)
  // Pastikan password 'root' benar. Jika kosong, hapus 'root' setelah titik dua (:)
  url      = "mysql://root:root@localhost:3306/db_sapi_seto"
}

enum StatusPembayaran {
  lunas
  belum_lunas
}

// Sesuai tabel `users` di SQL
model User {
  id             BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  name           String    @db.VarChar(100)
  username       String    @unique @db.VarChar(50)
  password       String    @db.VarChar(255)
  role           String    @default("kasir") @db.VarChar(20)
  remember_token String?   @db.VarChar(100)
  createdAt      DateTime  @default(now()) @db.Timestamp(0)
  updatedAt      DateTime  @updatedAt @db.Timestamp(0)

  sales     Sale[]
  purchases Purchase[]
  expenses  Expense[]

  @@map("users")
}

// Sesuai tabel `products` di SQL
model Product {
  id                  BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  product_name        String   @db.VarChar(150)
  stock               Int      @default(0)
  selling_price       Decimal  @db.Decimal(10, 2)
  last_purchase_price Decimal? @db.Decimal(10, 2)
  created_at          DateTime @default(now()) @db.Timestamp(0)
  update_at           DateTime @updatedAt @db.Timestamp(0)

  saleDetails     SaleDetail[]
  purchaseDetails PurchaseDetail[]

  @@map("products")
}

// Sesuai tabel `suppliers` di SQL
model Supplier {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  nama_supplier String   @db.VarChar(100)
  kontak        String?  @db.VarChar(100)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @updatedAt @db.Timestamp(0)

  purchases Purchase[]

  @@map("suppliers")
}

// Sesuai tabel `customers` di SQL
model Customer {
  id             BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  nama_pelanggan String   @db.VarChar(100)
  kontak         String?  @db.VarChar(100)
  createdAt      DateTime @default(now()) @db.Timestamp(0)
  updatedAt      DateTime @updatedAt @db.Timestamp(0)

  sales Sale[]

  @@map("customers")
}

// Sesuai tabel `sales` di SQL
model Sale {
  id                BigInt           @id @default(autoincrement()) @db.UnsignedBigInt
  userId            BigInt           @db.UnsignedBigInt
  customerId        BigInt?          @db.UnsignedBigInt
  tanggal_penjualan DateTime         @db.DateTime(0)
  subtotal          Decimal          @db.Decimal(10, 2)
  discount          Decimal          @default(0.00) @db.Decimal(10, 2)
  total_akhir       Decimal          @db.Decimal(10, 2)
  status_pembayaran StatusPembayaran
  note              String?          @db.Text
  createdAt         DateTime         @default(now()) @db.Timestamp(0)
  updatedAt         DateTime         @updatedAt @db.Timestamp(0)

  user     User      @relation(fields: [userId], references: [id])
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  saleDetails SaleDetail[]
  payments    PaymentReceivable[]

  @@map("sales")
}

// Sesuai tabel `purchases` di SQL
model Purchase {
  id                BigInt           @id @default(autoincrement()) @db.UnsignedBigInt
  userId            BigInt           @db.UnsignedBigInt
  supplierId        BigInt           @db.UnsignedBigInt
  tanggal_pembelian DateTime         @db.DateTime(0)
  total_pembelian   Decimal          @db.Decimal(10, 2)
  status_pembayaran StatusPembayaran
  note              String?          @db.Text
  createdAt         DateTime         @default(now()) @db.Timestamp(0)
  updatedAt         DateTime         @updatedAt @db.Timestamp(0)

  user     User     @relation(fields: [userId], references: [id])
  supplier Supplier @relation(fields: [supplierId], references: [id])

  purchaseDetails PurchaseDetail[]
  payments        PaymentPayable[]

  @@map("purchases")
}

// Sesuai tabel `expenses` di SQL
model Expense {
  id                  BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  userId              BigInt   @db.UnsignedBigInt
  tanggal_pengeluaran DateTime @db.Date
  jenis_pengeluaran   String   @db.VarChar(50)
  nominal             Decimal  @db.Decimal(10, 2)
  keterangan          String?  @db.Text
  createdAt           DateTime @default(now()) @db.Timestamp(0)
  updatedAt           DateTime @updatedAt @db.Timestamp(0)

  user User @relation(fields: [userId], references: [id])

  @@map("expenses")
}

// Sesuai tabel `sale_details` di SQL
model SaleDetail {
  id              BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  saleId          BigInt   @db.UnsignedBigInt
  productId       BigInt?  @db.UnsignedBigInt
  jumlah          Int
  harga_saat_jual Decimal  @db.Decimal(10, 2)
  createdAt       DateTime @default(now()) @db.Timestamp(0)
  updatedAt       DateTime @updatedAt @db.Timestamp(0)

  sale    Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("sale_details")
}

// Sesuai tabel `purchase_details` di SQL
model PurchaseDetail {
  id              BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  purchaseId      BigInt   @db.UnsignedBigInt
  productId       BigInt?  @db.UnsignedBigInt
  jumlah          Int
  harga_saat_beli Decimal  @db.Decimal(10, 2)
  createdAt       DateTime @default(now()) @db.Timestamp(0)
  updatedAt       DateTime @updatedAt @db.Timestamp(0)

  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  product  Product? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("purchase_details")
}

// Sesuai tabel `payments_receivable` di SQL
model PaymentReceivable {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  saleId        BigInt   @db.UnsignedBigInt
  tanggal_bayar DateTime @db.Date
  jumlah_bayar  Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @updatedAt @db.Timestamp(0)

  sale Sale @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@map("payments_receivable")
}

// Sesuai tabel `payments_payable` di SQL
model PaymentPayable {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  purchaseId    BigInt   @db.UnsignedBigInt
  tanggal_bayar DateTime @db.Date
  jumlah_bayar  Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @updatedAt @db.Timestamp(0)

  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  @@map("payments_payable")
}